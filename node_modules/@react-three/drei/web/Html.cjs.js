"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/extends"),t=require("@babel/runtime/helpers/objectWithoutPropertiesLoose"),r=require("react"),n=require("react-dom"),o=require("three"),i=require("@react-three/fiber");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function s(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var u=a(e),c=a(t),l=s(r),f=s(n),d=new o.Vector3,m=new o.Vector3,p=new o.Vector3;function h(e,t,r){var n=d.setFromMatrixPosition(e.matrixWorld);n.project(t);var o=r.width/2,i=r.height/2;return[n.x*o+o,-n.y*i+i]}var v=function(e){return Math.abs(e)<1e-10?0:e};function x(e,t,r){void 0===r&&(r="");for(var n="matrix3d(",o=0;16!==o;o++)n+=v(t[o]*e.elements[o])+(15!==o?",":")");return r+n}var b,y=(b=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],function(e){return x(e,b)}),M=function(e,t){return x(e,[1/(r=t),1/r,1/r,1,-1/r,-1/r,-1/r,-1,1/r,1/r,1/r,1,1,1,1,1],"translate(-50%,-50%)");var r},g=l.forwardRef((function(e,t){var r,n=e.children,a=e.eps,s=void 0===a?.001:a,x=e.style,b=e.className,g=e.prepend,P=e.center,w=e.fullscreen,W=e.portal,E=e.distanceFactor,T=e.sprite,j=void 0!==T&&T,F=e.transform,O=void 0!==F&&F,C=e.occluder,R=e.zIndexRange,z=void 0===R?[16777271,0]:R,I=e.calculatePosition,q=void 0===I?h:I,N=c.default(e,["children","eps","style","className","prepend","center","fullscreen","portal","distanceFactor","sprite","transform","occluder","zIndexRange","calculatePosition"]),H=i.useThree((function(e){return e.gl})),L=i.useThree((function(e){return e.camera})),_=i.useThree((function(e){return e.scene})),k=i.useThree((function(e){return e.size})),V=i.useThree((function(e){return e.raycaster})),D=l.useState((function(){return document.createElement("div")}))[0],S=l.useRef(null),A=l.useRef(0),Z=l.useRef([0,0]),B=l.useRef(null),G=l.useRef(null),J=null!==(r=null==W?void 0:W.current)&&void 0!==r?r:H.domElement.parentNode;l.useEffect((function(){if(S.current){if(_.updateMatrixWorld(),O)D.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{var e=q(S.current,L,k);D.style.cssText="position:absolute;top:0;left:0;transform:translate3d("+e[0]+"px,"+e[1]+"px,0);transform-origin:0 0;"}return J&&(g?J.prepend(D):J.appendChild(D)),function(){J&&J.removeChild(D),f.unmountComponentAtNode(D)}}}),[J,O]);var K=l.useMemo((function(){return O?{position:"absolute",top:0,left:0,width:k.width,height:k.height,transformStyle:"preserve-3d",pointerEvents:"none"}:u.default({position:"absolute",transform:P?"translate3d(-50%,-50%,0)":"none"},w&&{top:-k.height/2,left:-k.width/2,width:k.width,height:k.height},x)}),[x,P,w,k,O]),Q=l.useMemo((function(){return u.default({position:"absolute",pointerEvents:"auto"},x)}),[x]);return l.useLayoutEffect((function(){O?f.render(l.createElement("div",{ref:B,style:K},l.createElement("div",{ref:G,style:Q},l.createElement("div",{ref:t,className:b,children:n}))),D):f.render(l.createElement("div",{ref:t,style:K,className:b,children:n}),D)})),i.useFrame((function(){if(S.current){L.updateMatrixWorld();var e=O?Z.current:q(S.current,L,k);if(O||Math.abs(A.current-L.zoom)>s||Math.abs(Z.current[0]-e[0])>s||Math.abs(Z.current[1]-e[1])>s){var t=function(e,t){var r=d.setFromMatrixPosition(e.matrixWorld),n=m.setFromMatrixPosition(t.matrixWorld),o=r.sub(n),i=t.getWorldDirection(p);return o.angleTo(i)>Math.PI/2}(S.current,L);if(null!=C&&C.current){var r=function(e,t,r,n){var o=d.setFromMatrixPosition(e.matrixWorld),i=o.clone();i.project(t),r.setFromCamera(i,t);var a=r.intersectObject(n,!0);if(a.length){var s=a[0].distance;return o.distanceTo(t.position)<s}return!0}(S.current,L,V,null==C?void 0:C.current);D.style.display=r&&!t?"block":"none"}else D.style.display=t?"none":"block";if(D.style.zIndex=""+function(e,t,r){if(t instanceof o.PerspectiveCamera||t instanceof o.OrthographicCamera){var n=d.setFromMatrixPosition(e.matrixWorld),i=m.setFromMatrixPosition(t.matrixWorld),a=n.distanceTo(i),s=(r[1]-r[0])/(t.far-t.near),u=r[1]-s*t.far;return Math.round(s*a+u)}}(S.current,L,z),O){var n=k.width/2,i=k.height/2,a=L.projectionMatrix.elements[5]*i,u=L,c=u.isOrthographicCamera,l=u.top,f=u.left,h=u.bottom,x=u.right,b=y(L.matrixWorldInverse),g=c?"scale("+a+")translate("+v(-(x+f)/2)+"px,"+v((l+h)/2)+"px)":"translateZ("+a+"px)",P=S.current.matrixWorld;j&&((P=L.matrixWorldInverse.clone().transpose().copyPosition(P).scale(S.current.scale)).elements[3]=P.elements[7]=P.elements[11]=0,P.elements[15]=1),D.style.width=k.width+"px",D.style.height=k.height+"px",D.style.perspective=c?"":a+"px",B.current&&G.current&&(B.current.style.transform=""+g+b+"translate("+n+"px,"+i+"px)",G.current.style.transform=M(P,1/((E||10)/400)))}else{var w=void 0===E?1:function(e,t){if(t instanceof o.OrthographicCamera)return t.zoom;if(t instanceof o.PerspectiveCamera){var r=d.setFromMatrixPosition(e.matrixWorld),n=m.setFromMatrixPosition(t.matrixWorld),i=t.fov*Math.PI/180,a=r.distanceTo(n);return 1/(2*Math.tan(i/2)*a)}return 1}(S.current,L)*E;D.style.transform="translate3d("+e[0]+"px,"+e[1]+"px,0) scale("+w+")"}Z.current=e,A.current=L.zoom}}})),l.createElement("group",u.default({},N,{ref:S}))})),P=l.forwardRef((function(e,t){return l.useEffect((function(){console.warn("The <HTML> component was renamed to <Html>")}),[]),l.createElement(g,u.default({},e,{ref:t}))}));exports.HTML=P,exports.Html=g;
